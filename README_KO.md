# Hon (í˜¼)

[ğŸ‡°ğŸ‡· í•œêµ­ì–´ (Korean)](README_KO.md) | [ğŸ‡ºğŸ‡¸ English](README.md)

**Hon**ì€ [CloudWeGo Netpoll](https://github.com/cloudwego/netpoll) ê¸°ë°˜ì˜ ê³ ì„±ëŠ¥ HTTP ì—”ì§„ ì–´ëŒ‘í„°ì…ë‹ˆë‹¤. **Hon**ì€ "HTTP-over-Netpoll"ì˜ ì•½ìì…ë‹ˆë‹¤.

Go ì–¸ì–´ì˜ í‘œì¤€ `net/http` ì¸í„°í˜ì´ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ì„œ, ì´ë²¤íŠ¸ ê¸°ë°˜(epoll/kqueue)ì˜ Reactor íŒ¨í„´ì„ í†µí•œ ê³ ì„±ëŠ¥ I/O ì²˜ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ Gin, Chi, Echo ë“± ê¸°ì¡´ì˜ ì¸ê¸° ìˆëŠ” Go ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì½”ë“œ ë³€ê²½ ì—†ì´ Netpoll ìœ„ì—ì„œ ì‹¤í–‰í•˜ë©°, ëŒ€ê·œëª¨ ë™ì‹œ ì ‘ì† í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” íŠ¹ì§• (Key Features)

- **ì••ë„ì ì¸ ë™ì‹œì„± ì²˜ë¦¬**: Reactor íŒ¨í„´ì„ í†µí•´ **25,000ê°œ ì´ìƒì˜ ë™ì‹œ ì ‘ì†ì**ê°€ ìˆì–´ë„ ë‹¨ **6ê°œì˜ ê³ ë£¨í‹´**ë§Œìœ¼ë¡œ ì„œë²„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•©ë‹ˆë‹¤. (í‘œì¤€ ì„œë²„ ëŒ€ë¹„ ê³ ë£¨í‹´ ì‚¬ìš©ëŸ‰ 99.9% ì ˆê°)
- **í‘œì¤€ í˜¸í™˜ì„±**: `http.Handler` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì™„ë²½í•˜ê²Œ ì§€ì›í•˜ì—¬ `chi`, `gin`, `echo`, `mux` ë“± ê¸°ì¡´ ë¼ìš°í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
- **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±**: Thread-per-Connection ë°©ì‹ì˜ ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•˜ì—¬ CPU ì‚¬ìš© íš¨ìœ¨ì„ ê·¹ëŒ€í™”í–ˆìŠµë‹ˆë‹¤.
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: Netpollì˜ ê³ ì„±ëŠ¥ ë©”ëª¨ë¦¬ ìºì‹œ(`mcache`)ë¥¼ í™œìš©í•˜ì—¬ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ë©”ëª¨ë¦¬ í• ë‹¹/í•´ì œ ë¹„ìš©ì„ ìµœì†Œí™”í•˜ê³  ì•ˆì •ì ì¸ ì„±ëŠ¥ì„ ìœ ì§€í•©ë‹ˆë‹¤.
- **ì´ë²¤íŠ¸ ê¸°ë°˜ WebSocket**: `SetReadHandler`ë¥¼ í†µí•´ WebSocket ì—°ê²°ì¡°ì°¨ ê³ ë£¨í‹´ ì ìœ  ì—†ì´ ì´ë²¤íŠ¸ ë£¨í”„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë…ë³´ì ì¸ ì„±ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- **SSE ì§€ì›**: `http.Flusher` êµ¬í˜„ì„ í†µí•´ íš¨ìœ¨ì ì¸ Server-Sent Events ìŠ¤íŠ¸ë¦¬ë°ì„ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (Benchmark)

### 1. HTTP ì²˜ë¦¬ëŸ‰ (HTTP Throughput)

Honì€ ëŒ€ëŸ‰ì˜ ë‹¨ê¸° HTTP ìš”ì²­ ì²˜ë¦¬ì—ì„œë„ ì••ë„ì ì¸ ì„±ëŠ¥ì„ ë°œíœ˜í•©ë‹ˆë‹¤.
`bombardier`ë¥¼ ì‚¬ìš©í•˜ì—¬ **1,000ë§Œ ë²ˆì˜ ìš”ì²­**ì„ í…ŒìŠ¤íŠ¸í–ˆìŠµë‹ˆë‹¤ (125ê°œ ë™ì‹œ ì—°ê²°).

| ì§€í‘œ | í‘œì¤€ ì„œë²„ (`net/http`) | **Hon** | ê°œì„  íš¨ê³¼ |
| :--- | :--- | :--- | :--- |
| **ì´ˆë‹¹ ìš”ì²­ (RPS)** | ~108,556 | **~200,203** | **~1.85ë°° ë¹ ë¦„** |
| **í‰ê·  ì§€ì—° ì‹œê°„** | 1.15ms | **0.62ms** | **~46% ê°ì†Œ** |
| **ì²˜ë¦¬ëŸ‰ (Throughput)** | 53.83MB/s | **102.91MB/s** | **~1.9ë°° ì¦ê°€** |

> **ê²°ê³¼**: Honì€ ì¥ì‹œê°„ì˜ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ë¶€í•˜ ìƒí™©ì—ì„œ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë³´ë‹¤ í›¨ì”¬ ë” ë‚®ì€ ì§€ì—° ì‹œê°„ê³¼ ë†’ì€ ì²˜ë¦¬ëŸ‰ì„ ìœ ì§€í•©ë‹ˆë‹¤.

### 2. WebSocket ë™ì‹œì„± (ìì› íš¨ìœ¨)

ë‹¨ì¼ ë¨¸ì‹ (macOS)ì—ì„œ **25,000ê°œ ë™ì‹œ WebSocket ì ‘ì†** í…ŒìŠ¤íŠ¸ ê²°ê³¼:

| ì§€í‘œ | í‘œì¤€ ì„œë²„ (`net/http`) | **Hon (`Netpoll`)** | ê°œì„  íš¨ê³¼ |
| :--- | :--- | :--- | :--- |
| **ê³ ë£¨í‹´ ê°œìˆ˜** | **25,005 ê°œ** | **6 ê°œ** | **~99.9% ì ˆê°** |
| **ì•„í‚¤í…ì²˜** | ì—°ê²°ë‹¹ ê³ ë£¨í‹´ í• ë‹¹ | **ì´ë²¤íŠ¸ ê¸°ë°˜ Reactor** | **Non-blocking I/O** |

> **ì°¸ê³ **: í‘œì¤€ `net/http`ëŠ” ì—°ê²°ë‹¹ í•˜ë‚˜ì˜ ê³ ë£¨í‹´ì„ ìƒì„±í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì„ í˜•ì ìœ¼ë¡œ ì†Œëª¨í•˜ì§€ë§Œ, Honì€ Netpollì˜ ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ ë‹¨ 6ê°œì˜ ì›Œì»¤ ê³ ë£¨í‹´ë§Œìœ¼ë¡œ 25,000ê°œì˜ ì—°ê²°ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

## ğŸ“¦ ì„¤ì¹˜ (Installation)

```bash
go get github.com/DevNewbie1826/hon
```

## ğŸ’¡ ì‚¬ìš© ì˜ˆì œ (Usage)

### ê¸°ë³¸ ì‚¬ìš©ë²• (ìµœì í™” ì˜µì…˜ í¬í•¨)

```go
package main

import (
	"log"
	"net/http"
	"time"

	"github.com/DevNewbie1826/hon/pkg/engine"
	"github.com/DevNewbie1826/hon/pkg/server"
)

func main() {
	mux := http.NewServeMux()
	mux.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte("Hello, Hon!"))
	})

	// ë²„í¼ í¬ê¸° ìµœì í™” (Default: 4KB)
	eng := engine.NewEngine(mux, 
		engine.WithBufferSize(1024),
		engine.WithRequestTimeout(5*time.Second),
	)

	srv := server.NewServer(eng,
		server.WithReadTimeout(10*time.Second),
		server.WithWriteTimeout(10*time.Second),
	)

	log.Println("Server listening on :1826")
	if err := srv.Serve(":1826"); err != nil {
		log.Fatal(err)
	}
}
```

### ì´ë²¤íŠ¸ ê¸°ë°˜ WebSocket ì²˜ë¦¬ (Reactor Mode)

ê³ ë£¨í‹´ì„ ìƒì„±í•˜ì§€ ì•Šê³  WebSocket ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°€ì¥ íš¨ìœ¨ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.
ê¶Œì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬: `github.com/gobwas/ws`

```go
func wsHandler(w http.ResponseWriter, r *http.Request) {
    // Upgrade connection...
    if hijacker, ok := w.(adaptor.Hijacker); ok {
        hijacker.SetReadHandler(func(c net.Conn, rw *bufio.ReadWriter) error {
            // ì´ ì½œë°±ì€ Netpoll ì›Œì»¤ í’€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
            // ì ˆëŒ€ ì—¬ê¸°ì„œ ë¸”ë¡œí‚¹ ë£¨í”„(for loop)ë¥¼ ëŒë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤.
            
            // gobwas/wsutil ì‚¬ìš© ì˜ˆì œ
            msg, op, err := wsutil.ReadClientData(rw)
            if err != nil {
                return err
            }
            return wsutil.WriteServerMessage(rw, op, msg)
        })
    }
}
```

## ğŸ›  ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë„êµ¬

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— í¬í•¨ëœ `ws_stress_config.go`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì„±ëŠ¥ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# 1ë§Œê°œ ì—°ê²°ì„ 30ì´ˆê°„ ìœ ì§€í•˜ë©° í…ŒìŠ¤íŠ¸
go run ws_stress_config.go -c 10000 -hold 30s
```

## ğŸ— ì•„í‚¤í…ì²˜ (Architecture)

- **Server**: Netpollì˜ EventLoopë¥¼ ê´€ë¦¬í•˜ê³  TCP ì—°ê²°ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
- **Engine**: Connectionë³„ ìƒíƒœ(`ConnectionState`) ë° ë²„í¼ í’€ì„ ê´€ë¦¬í•˜ë©°, í•¸ë“¤ëŸ¬ë¡œ ìš”ì²­ì„ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.
- **Adaptor**: Netpollì˜ raw connectionê³¼ í‘œì¤€ `net/http` ê°ì²´ ê°„ì˜ ë³€í™˜ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

## ğŸ¤ ê¸°ì—¬ (Contributing)

ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ì œì•ˆì€ ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤. ì´ìŠˆë¥¼ ë“±ë¡í•˜ê±°ë‚˜ PRì„ ë³´ë‚´ì£¼ì„¸ìš”.

## ğŸ“„ ë¼ì´ì„ ìŠ¤ (License)

MIT License
