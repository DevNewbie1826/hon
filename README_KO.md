# Hon (í˜¼)

[ğŸ‡°ğŸ‡· í•œêµ­ì–´ (Korean)](README_KO.md) | [ğŸ‡ºğŸ‡¸ English](README.md)

**Hon**ì€ [CloudWeGo Netpoll](https://github.com/cloudwego/netpoll) ê¸°ë°˜ì˜ ê³ ì„±ëŠ¥ HTTP ì—”ì§„ ì–´ëŒ‘í„°ì…ë‹ˆë‹¤. **Hon**ì€ "HTTP-over-Netpoll"ì˜ ì•½ìì…ë‹ˆë‹¤.

Go ì–¸ì–´ì˜ í‘œì¤€ `net/http` ì¸í„°í˜ì´ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ì„œ, ì´ë²¤íŠ¸ ê¸°ë°˜(epoll/kqueue)ì˜ Reactor íŒ¨í„´ì„ í†µí•œ ê³ ì„±ëŠ¥ I/O ì²˜ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ Gin, Chi, Echo ë“± ê¸°ì¡´ì˜ ì¸ê¸° ìˆëŠ” Go ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì½”ë“œ ë³€ê²½ ì—†ì´ Netpoll ìœ„ì—ì„œ ì‹¤í–‰í•˜ë©°, ëŒ€ê·œëª¨ ë™ì‹œ ì ‘ì† í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” íŠ¹ì§• (Key Features)

- **ì••ë„ì ì¸ ë™ì‹œì„± ì²˜ë¦¬**: Reactor íŒ¨í„´ì„ í†µí•´ **25,000ê°œ ì´ìƒì˜ ë™ì‹œ ì ‘ì†ì**ê°€ ìˆì–´ë„ ë‹¨ **6ê°œì˜ ê³ ë£¨í‹´**ë§Œìœ¼ë¡œ ì„œë²„ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•©ë‹ˆë‹¤. (í‘œì¤€ ì„œë²„ ëŒ€ë¹„ ê³ ë£¨í‹´ ì‚¬ìš©ëŸ‰ 99.9% ì ˆê°)
- **í‘œì¤€ í˜¸í™˜ì„±**: `http.Handler` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì™„ë²½í•˜ê²Œ ì§€ì›í•˜ì—¬ `chi`, `gin`, `echo`, `mux` ë“± ê¸°ì¡´ ë¼ìš°í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
- **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±**: Thread-per-Connection ë°©ì‹ì˜ ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•˜ì—¬ CPU ì‚¬ìš© íš¨ìœ¨ì„ ê·¹ëŒ€í™”í–ˆìŠµë‹ˆë‹¤.
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: Netpollì˜ ê³ ì„±ëŠ¥ ë©”ëª¨ë¦¬ ìºì‹œ(`mcache`)ë¥¼ í™œìš©í•˜ì—¬ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ë©”ëª¨ë¦¬ í• ë‹¹/í•´ì œ ë¹„ìš©ì„ ìµœì†Œí™”í•˜ê³  ì•ˆì •ì ì¸ ì„±ëŠ¥ì„ ìœ ì§€í•©ë‹ˆë‹¤.
- **ì´ë²¤íŠ¸ ê¸°ë°˜ WebSocket**: `SetReadHandler`ë¥¼ í†µí•´ WebSocket ì—°ê²°ì¡°ì°¨ ê³ ë£¨í‹´ ì ìœ  ì—†ì´ ì´ë²¤íŠ¸ ë£¨í”„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë…ë³´ì ì¸ ì„±ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- **SSE ì§€ì›**: `http.Flusher` êµ¬í˜„ì„ í†µí•´ íš¨ìœ¨ì ì¸ Server-Sent Events ìŠ¤íŠ¸ë¦¬ë°ì„ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (Benchmark)

### 1. HTTP ì²˜ë¦¬ëŸ‰ (ê³ ì„±ëŠ¥)

**`wrk`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í–ˆìŠµë‹ˆë‹¤ (100ê°œ ì—°ê²°, 2ìŠ¤ë ˆë“œ, 10ì´ˆ).
**Standard** (`net/http`), **Standard + Reuseport**, ê·¸ë¦¬ê³  **Hon** ì„¸ ê°€ì§€ ëª¨ë“œë¥¼ ë¹„êµí–ˆìŠµë‹ˆë‹¤.

| ì§€í‘œ | Standard (`net/http`) | Std (`reuseport`) | **Hon** | vs Std | vs Reuse |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **ì´ˆë‹¹ ìš”ì²­ (RPS)** | 129,695 | 211,771 | **232,814** | **+79%** | **+10%** |
| **ì²˜ë¦¬ëŸ‰ (Throughput)** | 56.65MB/s | 92.50MB/s | **105.91MB/s** | **+87%** | **+14%** |

> **ë¶„ì„ ê²°ê³¼**: 
> - **Standard (`net/http`)**: ê¸°ì¤€ì´ ë˜ëŠ” í‘œì¤€ ì„±ëŠ¥ì…ë‹ˆë‹¤.
> - **Reuseport**: Listenerì˜ Lock ê²½í•©ì„ ì¤„ì—¬ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì—°ê²°ì„ ìˆ˜ë½í•˜ê²Œ í•¨ìœ¼ë¡œì¨ í‘œì¤€ ëŒ€ë¹„ **+63%**ì˜ ì²˜ë¦¬ëŸ‰ í–¥ìƒì„ ë³´ì˜€ìŠµë‹ˆë‹¤.
> - **Hon**: **Reactor íŒ¨í„´** (Netpoll)ê³¼ íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ í’€ë§ì„ í†µí•´ Reuseport ëª¨ë“œë³´ë‹¤ë„ **+10%**, í‘œì¤€ ëŒ€ë¹„ **+79%** ë” ë†’ì€ ì„±ëŠ¥ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. GC ë° ê³ ë£¨í‹´ ìŠ¤ì¼€ì¤„ë§ ì˜¤ë²„í—¤ë“œë¥¼ ìµœì†Œí™”í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

### 2. WebSocket ë™ì‹œì„± (ìì› íš¨ìœ¨)

ë‹¨ì¼ ë¨¸ì‹ (macOS)ì—ì„œ **15,000ê°œ ë™ì‹œ WebSocket ì ‘ì†** í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤.

| ì§€í‘œ | Standard (`net/http`) | Std (`reuseport`) | **Hon (`Netpoll`)** |
| :--- | :--- | :--- | :--- |
| **ì—°ê²° ìˆ˜** | 15,000 (ì•ˆì •ì ) | 15,000 (ì•ˆì •ì ) | **15,000 (ì•ˆì •ì )** |
| **ê³ ë£¨í‹´ ê°œìˆ˜** | 15,005 ê°œ | 15,005 ê°œ | **6 ê°œ** |
| **ì•„í‚¤í…ì²˜** | Thread-per-Conn | Thread-per-Conn | **Event-Driven Reactor** |

> **í•µì‹¬ ìš”ì•½**: 
> - **Standard & Reuseport**: ë‘ ëª¨ë“œ ëª¨ë‘ **Thread-per-Connection** ëª¨ë¸ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, 15,000ê°œì˜ ì—°ê²°ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ **15,005ê°œì˜ ê³ ë£¨í‹´**ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ëŠ” ìƒë‹¹í•œ ë©”ëª¨ë¦¬(ìŠ¤íƒ)ë¥¼ ì†Œëª¨í•˜ê³  ìŠ¤ì¼€ì¤„ë§ ì˜¤ë²„í—¤ë“œë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
> - **Hon**: **Reactor íŒ¨í„´**ì„ í™œìš©í•˜ì—¬ ë‹¨ **6ê°œì˜ ê³ ë£¨í‹´**ë§Œìœ¼ë¡œ ë™ì¼í•œ ë¶€í•˜ë¥¼ ì™„ë²½í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. **ì•½ 99.9%ì˜ ë¦¬ì†ŒìŠ¤ ì ˆê°** íš¨ê³¼ë¥¼ ë³´ì—¬ì£¼ë©°, ì´ëŠ” ìˆ˜ì‹­ë§Œ~ìˆ˜ë°±ë§Œ ë™ì‹œ ì ‘ì†(C10K/C10M) í™˜ê²½ì—ì„œ í•„ìˆ˜ì ì¸ ì„±ëŠ¥ì…ë‹ˆë‹¤.

## ğŸ“¦ ì„¤ì¹˜ (Installation)

```bash
go get github.com/DevNewbie1826/hon
```

## ğŸ’¡ ì‚¬ìš© ë°©ë²• (Usage)

### ê¸°ë³¸ ì‚¬ìš©ë²•

ì œê³µëœ ì˜ˆì œ ì„œë²„ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ëª¨ë“œë¥¼ ì§ì ‘ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# Hon ëª¨ë“œ ì‹¤í–‰ (ê¸°ë³¸ê°’)
go run cmd/example/main.go -type hon

# Standard ëª¨ë“œ ì‹¤í–‰ (net/http)
go run cmd/example/main.go -type std

# Reuseport ëª¨ë“œ ì‹¤í–‰ (net/http + reuseport)
go run cmd/example/main.go -type reuseport
```

### ì´ë²¤íŠ¸ ê¸°ë°˜ WebSocket ì²˜ë¦¬ (Reactor Mode)

ê³ ë£¨í‹´ì„ ìƒì„±í•˜ì§€ ì•Šê³  WebSocket ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°€ì¥ íš¨ìœ¨ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.
ê¶Œì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬: `github.com/gobwas/ws`

```go
func wsHandler(w http.ResponseWriter, r *http.Request) {
    // Upgrade connection...
    if hijacker, ok := w.(adaptor.Hijacker); ok {
        hijacker.SetReadHandler(func(c net.Conn, rw *bufio.ReadWriter) error {
            // ì´ ì½œë°±ì€ Netpoll ì›Œì»¤ í’€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
            // ì ˆëŒ€ ì—¬ê¸°ì„œ ë¸”ë¡œí‚¹ ë£¨í”„(for loop)ë¥¼ ëŒë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤.
            
            // gobwas/wsutil ì‚¬ìš© ì˜ˆì œ
            msg, op, err := wsutil.ReadClientData(rw)
            if err != nil {
                return err
            }
            return wsutil.WriteServerMessage(rw, op, msg)
        })
    }
}
```

## ğŸ›  ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë„êµ¬

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— í¬í•¨ëœ `ws_stress_config.go`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì„±ëŠ¥ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# 1ë§Œê°œ ì—°ê²°ì„ 30ì´ˆê°„ ìœ ì§€í•˜ë©° í…ŒìŠ¤íŠ¸
go run ws_stress_config.go -c 10000 -hold 30s
```

## ğŸ— ì•„í‚¤í…ì²˜ (Architecture)

- **Server**: Netpollì˜ EventLoopë¥¼ ê´€ë¦¬í•˜ê³  TCP ì—°ê²°ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
- **Engine**: Connectionë³„ ìƒíƒœ(`ConnectionState`) ë° ë²„í¼ í’€ì„ ê´€ë¦¬í•˜ë©°, í•¸ë“¤ëŸ¬ë¡œ ìš”ì²­ì„ ë””ìŠ¤íŒ¨ì¹˜í•©ë‹ˆë‹¤.
- **Adaptor**: Netpollì˜ raw connectionê³¼ í‘œì¤€ `net/http` ê°ì²´ ê°„ì˜ ë³€í™˜ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

## ğŸ¤ ê¸°ì—¬ (Contributing)

ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ì œì•ˆì€ ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤. ì´ìŠˆë¥¼ ë“±ë¡í•˜ê±°ë‚˜ PRì„ ë³´ë‚´ì£¼ì„¸ìš”.

## ğŸ“„ ë¼ì´ì„ ìŠ¤ (License)

MIT License
